<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kids Study Buddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Quicksand', sans-serif; touch-action: manipulation; }
        .kids-font { font-family: 'Fredoka One', cursive; }
        .btn-bounce:active { transform: scale(0.95); }
        .mic-active { background-color: #ef4444 !important; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        .wave-bar { width: 4px; height: 8px; background-color: white; border-radius: 2px; transition: height 0.1s ease; margin: 0 2px; }
        .shake { animation: shake 0.4s ease-in-out; }
        @keyframes shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-10px);} 75%{transform:translateX(10px);} }
    </style>
</head>
<body class="bg-yellow-50 dark:bg-slate-900 flex flex-col items-center justify-start min-h-screen p-4 overflow-hidden select-none">

    <div class="fixed top-4 w-full max-w-2xl px-6 flex flex-col gap-2 z-20">
        <div class="flex justify-between items-center gap-2">
            <div class="flex gap-2">
                <div class="bg-white dark:bg-slate-800 rounded-full px-4 py-2 shadow-md border-2 border-yellow-400">
                    <span class="text-lg font-bold text-yellow-600 dark:text-yellow-400" id="progressText">0 / 0</span>
                </div>
                <div class="bg-white dark:bg-slate-800 rounded-full px-4 py-2 shadow-md border-2 border-green-400">
                    <span class="text-lg font-bold text-green-600 dark:text-green-400">‚≠ê <span id="starCount">0</span></span>
                </div>
            </div>
            <button onclick="document.documentElement.classList.toggle('dark')" class="bg-white dark:bg-slate-800 p-2 rounded-full shadow-md border-2 border-purple-400 text-purple-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
            </button>
        </div>

        <div class="flex flex-wrap justify-center items-center gap-2 mt-2">
            <button onclick="filterCategory('Alphabet')" class="bg-blue-500 text-white px-3 py-1 rounded-full font-bold text-sm shadow-md">ABC</button>
            <button onclick="filterCategory('Numbers')" class="bg-green-500 text-white px-3 py-1 rounded-full font-bold text-sm shadow-md">123</button>
            <button onclick="filterCategory('Words')" class="bg-purple-500 text-white px-3 py-1 rounded-full font-bold text-sm shadow-md">WORDS</button>
            <div class="flex gap-1 ml-auto">
                <button onclick="changeFont(-1)" class="bg-gray-200 dark:bg-slate-700 dark:text-white px-3 py-1 rounded-full font-bold">-</button>
                <button onclick="changeFont(1)" class="bg-gray-200 dark:bg-slate-700 dark:text-white px-3 py-1 rounded-full font-bold">+</button>
            </div>
        </div>
    </div>

    <main id="mainCard" class="w-full max-w-lg bg-white dark:bg-slate-800 rounded-3xl shadow-2xl p-6 border-b-8 border-gray-200 dark:border-slate-950 relative mt-32 transition-all">
        <div class="flex flex-col items-center justify-center min-h-[250px] mb-6">
            <h1 id="mainWord" class="kids-font tracking-wide mb-2 text-center text-9xl dark:text-white">A</h1>
            <p id="feedbackText" class="text-xl font-bold text-gray-400 text-center px-4 h-14 flex items-center justify-center">Press Listen, then Say it!</p>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <button onclick="listenToWord()" class="btn-bounce flex flex-col items-center justify-center bg-orange-400 text-white rounded-2xl py-6 shadow-lg border-b-4 border-orange-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                <span class="font-bold uppercase">LISTEN</span>
            </button>
            <button id="speakBtn" onclick="toggleMic()" class="btn-bounce flex flex-col items-center justify-center bg-red-400 text-white rounded-2xl py-6 shadow-lg border-b-4 border-red-600 relative transition-all">
                <div id="waveform" class="flex items-end justify-center gap-1 h-10 mb-2 hidden">
                    <div class="wave-bar h-4"></div><div class="wave-bar h-8"></div><div class="wave-bar h-6"></div>
                    <div class="wave-bar h-10"></div><div class="wave-bar h-5"></div>
                </div>
                <svg id="micIcon" xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>
                <span id="micBtnText" class="font-bold uppercase">SAY IT</span>
            </button>
        </div>

        <div class="flex items-center justify-between gap-4">
            <button onclick="prevWord()" class="btn-bounce bg-gray-200 dark:bg-slate-700 text-gray-600 dark:text-gray-300 rounded-full p-4 flex-1 font-bold">BACK</button>
            <button onclick="nextWord()" class="btn-bounce bg-blue-500 text-white rounded-full p-4 flex-[2] font-bold shadow-lg border-b-4 border-blue-700">NEXT</button>
        </div>
    </main>

    <div id="modal" class="fixed inset-0 bg-black/60 hidden flex items-center justify-center z-50 p-4 backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl transition-all" id="modalContent">
            <div id="modalIcon" class="text-6xl mb-4">‚≠ê</div>
            <h2 id="modalTitle" class="kids-font text-3xl text-green-600 mb-2">Wow!</h2>
            <p id="modalMsg" class="text-xl text-gray-600 dark:text-gray-300 mb-6"></p>
            <button onclick="closeModal()" class="w-full bg-green-500 text-white rounded-2xl py-4 font-bold text-xl border-b-4 border-green-700">CONTINUE</button>
        </div>
    </div>

    <script>
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").map(l => ({word: l, type: "Alphabet"}));
        const numbers = Array.from({length: 21}, (_, i) => ({word: i.toString(), type: "Numbers"}));
        const shortWords = [
            "am","an","as","at","be","by","do","go","he","hi","if","in","is","it","me","my","no","of","oh","on","or","so","to","up","us","we",
            "cat","dog","hat","pig","sun","bus","red","big","hot","cup","bat","bed","box","can","cap","dad","fan","fox","gum","jet",
            "leg","lid","log","mad","map","net","nut","pan","pen","pet","pot","rat","rug","sat","sit","tag","ten","top","tub","van",
            "wet","wig","win","zip","bag","bug","dig","fit","get","hop","job","key","lap","ink","ice","owl","egg","cow","fly","sky"
        ].map(w => ({word: w.toUpperCase(), type: "Words"}));

        let allContent = [...letters, ...numbers, ...shortWords];
        
        // Shuffle helper
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        let words = shuffle([...allContent]);
        let currentIndex = 0;
        let stars = 0;
        let fontSizeRem = 8;
        let isListening = false;

        const recognition = (window.SpeechRecognition || window.webkitSpeechRecognition) ? new (window.SpeechRecognition || window.webkitSpeechRecognition)() : null;
        if (recognition) {
            recognition.continuous = false;
            recognition.lang = 'en-US';
            recognition.interimResults = false;

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.trim().toUpperCase();
                checkAnswer(transcript);
            };

            recognition.onend = () => {
                stopMicUI();
            };

            recognition.onerror = () => {
                stopMicUI();
                showFeedback("Didn't hear that. Try again!", "text-red-500");
            };
        }

        function updateDisplay() {
            const item = words[currentIndex];
            const mainWordEl = document.getElementById('mainWord');
            mainWordEl.textContent = item.word;
            mainWordEl.style.fontSize = fontSizeRem + "rem";
            document.getElementById('progressText').textContent = `${currentIndex + 1} / ${words.length}`;
            showFeedback("Press Listen, then Say it!", "text-gray-400");
        }

        function nextWord() {
            if (currentIndex < words.length - 1) {
                currentIndex++;
                updateDisplay();
            } else {
                showModal("üèÜ", "Expert!", "You finished the whole list!");
                currentIndex = 0;
                words = shuffle([...allContent]);
                updateDisplay();
            }
        }

        function prevWord() {
            if (currentIndex > 0) {
                currentIndex--;
                updateDisplay();
            }
        }

        function changeFont(delta) {
            fontSizeRem = Math.max(3, Math.min(15, fontSizeRem + delta));
            document.getElementById('mainWord').style.fontSize = fontSizeRem + "rem";
        }

        function filterCategory(cat) {
            words = shuffle(allContent.filter(w => w.type === cat));
            currentIndex = 0;
            updateDisplay();
        }

        function listenToWord() {
            const word = words[currentIndex].word;
            const u = new SpeechSynthesisUtterance(word.toLowerCase()); // Lowercase avoids "Capital" trigger
            u.rate = 0.8;
            u.pitch = 1.2;
            window.speechSynthesis.speak(u);
        }

        function toggleMic() {
            if (!recognition) {
                showFeedback("Mic not supported on this browser.", "text-red-500");
                return;
            }
            if (isListening) {
                recognition.stop();
            } else {
                startMicUI();
                recognition.start();
            }
        }

        function startMicUI() {
            isListening = true;
            const btn = document.getElementById('speakBtn');
            btn.classList.add('mic-active');
            document.getElementById('micIcon').classList.add('hidden');
            document.getElementById('waveform').classList.remove('hidden');
            document.getElementById('micBtnText').textContent = "LISTENING...";
        }

        function stopMicUI() {
            isListening = false;
            const btn = document.getElementById('speakBtn');
            btn.classList.remove('mic-active');
            document.getElementById('micIcon').classList.remove('hidden');
            document.getElementById('waveform').classList.add('hidden');
            document.getElementById('micBtnText').textContent = "SAY IT";
        }

        function checkAnswer(said) {
            const target = words[currentIndex].word;
            // Handle numbers (synthesis vs transcript)
            const cleanSaid = said.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").toUpperCase();
            
            if (cleanSaid === target || cleanSaid.includes(target)) {
                stars++;
                document.getElementById('starCount').textContent = stars;
                showFeedback("Correct! Perfect!", "text-green-500");
                document.getElementById('mainCard').classList.add('ring-4', 'ring-green-400');
                setTimeout(() => {
                    document.getElementById('mainCard').classList.remove('ring-4', 'ring-green-400');
                    nextWord();
                }, 1000);
            } else {
                showFeedback(`I heard "${said}". Try again!`, "text-orange-500");
                document.getElementById('mainCard').classList.add('shake');
                setTimeout(() => document.getElementById('mainCard').classList.remove('shake'), 400);
            }
        }

        function showFeedback(text, colorClass) {
            const f = document.getElementById('feedbackText');
            f.textContent = text;
            f.className = `text-xl font-bold text-center px-4 h-14 flex items-center justify-center ${colorClass}`;
        }

        function showModal(icon, title, msg) {
            document.getElementById('modalIcon').textContent = icon;
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMsg').textContent = msg;
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        window.onload = updateDisplay;
    </script>
</body>
</html>

