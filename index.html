<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® Kids Study Buddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    <style>
        body { font-family: 'Quicksand', sans-serif; touch-action: manipulation; }
        .kids-font { font-family: 'Fredoka One', cursive; }
        .btn-bounce:active { transform: scale(0.95); }
        .mic-active { animation: pulse-red 1s infinite; background-color: #ef4444 !important; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
    </style>
</head>
<body class="bg-yellow-50 dark:bg-slate-900 flex flex-col items-center justify-center min-h-screen p-4 overflow-hidden select-none">

    <div class="fixed top-4 w-full max-w-2xl px-6 flex justify-between items-center z-20 gap-2">
        <div class="flex gap-2">
            <div class="bg-white dark:bg-slate-800 rounded-full px-4 py-2 shadow-md border-2 border-yellow-400">
                <span class="text-lg font-bold text-yellow-600 dark:text-yellow-400" id="progressText">1 / 130</span>
            </div>
            <div class="bg-white dark:bg-slate-800 rounded-full px-4 py-2 shadow-md border-2 border-green-400">
                <span class="text-lg font-bold text-green-600 dark:text-green-400">‚≠ê <span id="starCount">0</span></span>
            </div>
        </div>
        <button onclick="document.documentElement.classList.toggle('dark')" class="bg-white dark:bg-slate-800 p-2 rounded-full shadow-md border-2 border-purple-400 text-purple-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
        </button>
    </div>

    <main class="w-full max-w-lg bg-white dark:bg-slate-800 rounded-3xl shadow-2xl p-6 border-b-8 border-gray-200 dark:border-slate-950 relative mt-12 transition-all">
        <div class="flex justify-center mb-4">
            <div id="categoryBadge" class="bg-blue-500 text-white px-6 py-1 rounded-full text-lg font-bold shadow-md uppercase">ALPHABET</div>
        </div>

        <div class="flex flex-col items-center justify-center min-h-[250px] mb-6">
            <h1 id="mainWord" class="kids-font tracking-wide mb-2 text-center text-9xl">A</h1>
            <p id="feedbackText" class="text-xl font-bold text-gray-400 text-center px-4 h-14 flex items-center justify-center">Click Listen, then Say it!</p>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <button onclick="listenToWord()" class="btn-bounce flex flex-col items-center justify-center bg-orange-400 text-white rounded-2xl py-6 shadow-lg border-b-4 border-orange-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                <span class="font-bold uppercase">LISTEN</span>
            </button>
            <button id="speakBtn" onclick="handleMicClick()" class="btn-bounce flex flex-col items-center justify-center bg-red-400 text-white rounded-2xl py-6 shadow-lg border-b-4 border-red-600 relative transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>
                <span id="micBtnText" class="font-bold uppercase">SAY IT</span>
            </button>
        </div>

        <div class="flex items-center justify-between gap-4">
            <button onclick="prevWord()" class="btn-bounce bg-gray-200 dark:bg-slate-700 text-gray-600 dark:text-gray-300 rounded-full p-4 flex-1 font-bold">BACK</button>
            <button onclick="nextWord()" class="btn-bounce bg-blue-500 text-white rounded-full p-4 flex-[2] font-bold shadow-lg border-b-4 border-blue-700">NEXT</button>
        </div>
    </main>

    <div id="modal" class="fixed inset-0 bg-black/60 hidden flex items-center justify-center z-50 p-4 backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl scale-0 transition-transform duration-300" id="modalContent">
            <div class="text-6xl mb-4">üèÜ</div>
            <h2 class="kids-font text-3xl text-green-600 mb-2">Great Job!</h2>
            <p id="modalMsg" class="text-xl text-gray-600 dark:text-gray-300 mb-6"></p>
            <button onclick="closeModal()" class="w-full bg-green-500 text-white rounded-2xl py-4 font-bold text-xl border-b-4 border-green-700">CONTINUE</button>
        </div>
    </div>

    <script>
        const words = [
            ...Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZ").map(l => ({word: l, type: "Alphabet"})),
            ...Array.from({length: 20}, (_, i) => ({word: (i+1).toString(), type: "Numbers"})),
            ...["am","an","as","at","be","by","do","go","he","hi","if","in","is","it","me","my","no","of","oh","on","or","so","to","up","us","we"].map(w => ({word: w, type: "Words"})),
            ...["cat","dog","hat","pig","sun","bus","red","big","hot","cup","bat","bed","box","can","cap","dad","fan","fox","gum","jet","leg","lid","log","mad","map","net","nut","pan","pen","pet","pot","rat","rug","sat","sit","tag","ten","top","tub","van","wet","wig","win","zip","bag","bug","dig","fit","get","hop","job","key","lap","ink","ice","owl","egg","cow"].map(w => ({word: w, type: "Words"}))
        ];

        let currentIndex = 0;
        let stars = 0;
        let isListening = false;
        let transcriptBuffer = "";

        const mainWordEl = document.getElementById('mainWord');
        const feedbackEl = document.getElementById('feedbackText');
        const progressEl = document.getElementById('progressText');
        const starEl = document.getElementById('starCount');
        const categoryBadge = document.getElementById('categoryBadge');
        const speakBtn = document.getElementById('speakBtn');
        const micBtnText = document.getElementById('micBtnText');

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSfx(freq, dur = 0.2) {
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.frequency.setValueAtTime(freq, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + dur);
        }

        const synth = window.speechSynthesis;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onresult = (e) => {
                transcriptBuffer = Array.from(e.results)
                    .map(result => result[0].transcript)
                    .join('').toLowerCase().trim();
                
                const target = words[currentIndex].word.toLowerCase();
                if (transcriptBuffer.includes(target)) {
                    evaluateNow();
                }
            };

            recognition.onerror = () => stopMicUI();
            recognition.onend = () => { if (isListening) recognition.start(); };
        }

        function handleMicClick() {
            if (isListening) {
                evaluateNow();
            } else {
                startMic();
            }
        }

        function startMic() {
            if (!recognition) return;
            isListening = true;
            transcriptBuffer = "";
            speakBtn.classList.add('mic-active');
            micBtnText.textContent = "STOP & CHECK";
            feedbackEl.textContent = "Listening...";
            playSfx(440, 0.1);
            recognition.start();
        }

        function evaluateNow() {
            if (!isListening) return;
            const target = words[currentIndex].word.toLowerCase();
            const heard = transcriptBuffer;
            
            stopMicUI();

            // Lenient matching for kids
            const numMap = {"one":"1","two":"2","three":"3","four":"4","five":"5","six":"6","seven":"7","eight":"8","nine":"9","ten":"10","eleven":"11","twelve":"12","thirteen":"13","fourteen":"14","fifteen":"15","sixteen":"16","seventeen":"17","eighteen":"18","nineteen":"19","twenty":"20"};
            const isMatch = heard.includes(target) || (numMap[heard] && numMap[heard] === target) || heard.split(' ').some(w => w === target);

            if (isMatch) {
                handleSuccess();
            } else {
                feedbackEl.textContent = heard ? `I heard "${heard}". Try again!` : "I didn't hear anything. Try again!";
                playSfx(200, 0.3);
            }
        }

        function stopMicUI() {
            isListening = false;
            recognition?.stop();
            speakBtn.classList.remove('mic-active');
            micBtnText.textContent = "SAY IT";
        }

        function handleSuccess() {
            stars++;
            starEl.textContent = stars;
            playSfx(880, 0.4);
            document.getElementById('modalMsg').textContent = `Correct! You said "${words[currentIndex].word}"`;
            document.getElementById('modal').classList.remove('hidden');
            setTimeout(() => document.getElementById('modalContent').classList.add('scale-100'), 10);
        }

        function updateDisplay() {
            stopMicUI();
            const c = words[currentIndex];
            mainWordEl.textContent = c.word;
            categoryBadge.textContent = c.type;
            progressEl.textContent = `${currentIndex + 1} / ${words.length}`;
            feedbackEl.textContent = "Click Listen, then Say it!";
            
            const badges = {"Alphabet": "bg-blue-500", "Numbers": "bg-green-500", "Words": "bg-purple-500"};
            categoryBadge.className = `${badges[c.type]} text-white px-6 py-1 rounded-full text-lg font-bold shadow-md uppercase`;
            
            const colors = ['text-blue-500', 'text-purple-500', 'text-pink-500', 'text-indigo-500', 'text-green-500', 'text-orange-500'];
            mainWordEl.className = `kids-font tracking-wide mb-2 text-center text-9xl ${colors[currentIndex % colors.length]}`;
        }

        function listenToWord() {
            synth.cancel();
            const u = new SpeechSynthesisUtterance(words[currentIndex].word.toLowerCase());
            u.rate = 0.75;
            u.pitch = 1.2;
            synth.speak(u);
        }

        function nextWord() {
            if (currentIndex < words.length - 1) { currentIndex++; updateDisplay(); }
        }

        function prevWord() {
            if (currentIndex > 0) { currentIndex--; updateDisplay(); }
        }

        function closeModal() {
            document.getElementById('modalContent').classList.remove('scale-100');
            setTimeout(() => {
                document.getElementById('modal').classList.add('hidden');
                nextWord();
            }, 300);
        }

        window.onload = updateDisplay;
    </script>
</body>
</html>

