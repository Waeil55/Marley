<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üé® Kids Study Buddy</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">

<script>
tailwind.config = { darkMode: 'class' }
</script>

<style>
body { font-family: 'Quicksand', sans-serif; touch-action: manipulation; }
.kids-font { font-family: 'Fredoka One', cursive; }
.btn-bounce:active { transform: scale(0.95); }

.mic-active {
    animation: pulse-red 0.8s infinite;
    background-color: #ef4444 !important;
}

@keyframes pulse-red {
    0% { box-shadow: 0 0 0 0 rgba(239,68,68,.7); }
    70% { box-shadow: 0 0 0 30px rgba(239,68,68,0); }
    100% { box-shadow: 0 0 0 0 rgba(239,68,68,0); }
}

.glow-success {
    box-shadow: 0 0 40px rgba(34,197,94,.7);
    transition: all .2s;
}

.shake { animation: shake .4s ease-in-out; }

@keyframes shake {
    0%,100%{transform:translateX(0)}
    25%{transform:translateX(-8px)}
    75%{transform:translateX(8px)}
}
</style>
</head>

<body class="bg-yellow-50 dark:bg-slate-900 flex flex-col items-center justify-center min-h-screen p-4 overflow-hidden select-none">

<div class="fixed top-4 w-full max-w-2xl px-6 flex justify-between items-center z-20 gap-2">
    <div class="flex gap-2">
        <div class="bg-white dark:bg-slate-800 rounded-full px-4 py-2 shadow-md border-2 border-yellow-400">
            <span class="text-lg font-bold text-yellow-600 dark:text-yellow-400" id="progressText">1 / 100</span>
        </div>
        <div class="bg-white dark:bg-slate-800 rounded-full px-4 py-2 shadow-md border-2 border-green-400">
            <span class="text-lg font-bold text-green-600 dark:text-green-400">‚≠ê <span id="starCount">0</span></span>
        </div>
    </div>

    <button onclick="document.documentElement.classList.toggle('dark')" class="bg-white dark:bg-slate-800 p-2 rounded-full shadow-md border-2 border-purple-400 text-purple-500">
        üåô
    </button>
</div>

<main id="mainCard" class="w-full max-w-lg bg-white dark:bg-slate-800 rounded-3xl shadow-2xl p-6 border-b-8 border-gray-200 dark:border-slate-950 relative mt-12 transition-all">

<div class="flex justify-center mb-4">
    <div id="categoryBadge" class="bg-blue-500 text-white px-6 py-1 rounded-full text-lg font-bold shadow-md uppercase">
        ALPHABET
    </div>
</div>

<div class="flex flex-col items-center justify-center min-h-[250px] mb-6">
    <h1 id="mainWord" class="kids-font text-9xl text-blue-500 text-center">A</h1>
    <p id="feedbackText" class="text-xl font-bold text-gray-400 text-center h-14 flex items-center justify-center">
        Click Listen, then Say it!
    </p>
</div>

<div class="grid grid-cols-2 gap-4 mb-6">
    <button onclick="listenToWord()" class="btn-bounce bg-orange-400 text-white rounded-2xl py-6 shadow-lg border-b-4 border-orange-600 font-bold">
        üîä LISTEN
    </button>

    <button id="speakBtn" onclick="startMic()" class="btn-bounce bg-red-400 text-white rounded-2xl py-6 shadow-lg border-b-4 border-red-600 font-bold">
        üé§ SAY IT
    </button>
</div>

<div class="flex items-center justify-between gap-4">
    <button onclick="prevWord()" class="btn-bounce bg-gray-200 dark:bg-slate-700 text-gray-600 dark:text-gray-300 rounded-full p-4 flex-1 font-bold">
        BACK
    </button>
    <button onclick="nextWord()" class="btn-bounce bg-blue-500 text-white rounded-full p-4 flex-[2] font-bold shadow-lg border-b-4 border-blue-700">
        NEXT
    </button>
</div>

</main>

<script>

/* ========================
   WORD DATA
======================== */

const words = [
...Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZ").map(l=>({word:l,type:"Alphabet"})),
...Array.from({length:20},(_,i)=>({word:(i+1).toString(),type:"Numbers"})),
..."cat dog sun hat cup red big box pen bus pig map fan log run zip bat bed cap can dad fox gum".split(" ").map(w=>({word:w,type:"Words"}))
];

let currentIndex = 0;
let stars = 0;

/* ========================
   DISPLAY
======================== */

function updateDisplay(){
    const c = words[currentIndex];
    document.getElementById("mainWord").textContent = c.word;
    document.getElementById("categoryBadge").textContent = c.type;
    document.getElementById("progressText").textContent =
        `${currentIndex+1} / ${words.length}`;
    document.getElementById("feedbackText").textContent =
        "Click Listen, then Say it!";
    document.getElementById("feedbackText").className =
        "text-xl font-bold text-gray-400 text-center h-14 flex items-center justify-center";
}

function nextWord(){
    if(currentIndex < words.length-1){
        currentIndex++;
        updateDisplay();
    }
}

function prevWord(){
    if(currentIndex>0){
        currentIndex--;
        updateDisplay();
    }
}

/* ========================
   TEXT TO SPEECH (NO "CAPITAL")
======================== */

function listenToWord(){
    speechSynthesis.cancel();

    let word = words[currentIndex].word;

    // Prevent saying "capital"
    if(word.length === 1 && isNaN(word)){
        word = word.toLowerCase();
    }

    const u = new SpeechSynthesisUtterance(word);
    u.rate = 0.9;
    u.pitch = 1.1;
    speechSynthesis.speak(u);
}

/* ========================
   PRO MIC ENGINE
======================== */

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition = null;
let isListening = false;
let silenceTimer = null;

if(SpeechRecognition){
    recognition = new SpeechRecognition();
    recognition.lang = "en-US";
    recognition.interimResults = false;
    recognition.continuous = false;
    recognition.maxAlternatives = 3;

    recognition.onresult = (event)=>{
        clearTimeout(silenceTimer);
        const result = event.results[0][0];
        const spoken = result.transcript.toLowerCase().trim();
        const confidence = result.confidence;
        evaluateSpeech(spoken,confidence);
    };

    recognition.onend = ()=> stopMicUI();
    recognition.onerror = ()=> {
        stopMicUI();
        showError("Mic error. Try again!");
    };
}

function startMic(){
    if(!recognition || isListening) return;

    isListening = true;
    document.getElementById("speakBtn").classList.add("mic-active");
    document.getElementById("feedbackText").textContent = "Listening...";

    try{
        recognition.start();
        silenceTimer = setTimeout(()=> recognition.stop(),3000);
    }catch(e){}
}

function stopMicUI(){
    isListening = false;
    document.getElementById("speakBtn").classList.remove("mic-active");
}

function evaluateSpeech(spoken,confidence){

    const target = words[currentIndex].word.toLowerCase();

    const numMap = {
        "one":"1","two":"2","three":"3","four":"4","five":"5",
        "six":"6","seven":"7","eight":"8","nine":"9","ten":"10",
        "eleven":"11","twelve":"12","thirteen":"13","fourteen":"14",
        "fifteen":"15","sixteen":"16","seventeen":"17","eighteen":"18",
        "nineteen":"19","twenty":"20"
    };

    let match = false;

    if(spoken === target) match = true;
    if(numMap[spoken] === target) match = true;
    if(confidence < 0.65) match = false;

    if(match){
        stars++;
        document.getElementById("starCount").textContent = stars;
        document.getElementById("feedbackText").textContent = "Correct! üéâ";
        document.getElementById("feedbackText").classList.add("text-green-500");
        document.getElementById("mainCard").classList.add("glow-success");

        setTimeout(()=>{
            document.getElementById("mainCard").classList.remove("glow-success");
            nextWord();
        },1000);
    }else{
        showError(`I heard "${spoken}". Try again!`);
    }
}

function showError(msg){
    document.getElementById("feedbackText").textContent = msg;
    document.getElementById("feedbackText").classList.add("text-red-500");
    document.getElementById("mainCard").classList.add("shake");
    setTimeout(()=>{
        document.getElementById("mainCard").classList.remove("shake");
    },400);
}

updateDisplay();

</script>
</body>
</html>